{% extends 'statistiques/base.html' %}

{% block title %}Tableau de bord - AppISIS{% endblock %}

{% block content %}
<h1 class="mb-4">
    <i class="fas fa-tachometer-alt mr-2"></i>
    Tableau de bord
</h1>

<div class="row">
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line mr-2"></i>
                    Résumé des statistiques
                </h5>
            </div>
            <div class="card-body">
                {% if statistics %}
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-users mr-2"></i>
                                    Nombre total d'étudiants
                                </div>
                                <div class="card-body text-center">
                                    <h2 class="mb-0 text-success">
                                        {{ statistics.total_students.fie1|add:statistics.total_students.fie2|add:statistics.total_students.fie3 }}
                                    </h2>
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <strong>FIE1:</strong> {{ statistics.total_students.fie1 }}<br>
                                            <strong>FIE2:</strong> {{ statistics.total_students.fie2 }}<br>
                                            <strong>FIE3:</strong> {{ statistics.total_students.fie3 }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header bg-info text-white">
                                    <i class="fas fa-percentage mr-2"></i>
                                    Taux moyen de boursiers
                                </div>
                                <div class="card-body text-center">
                                    <h2 class="mb-0 text-info">
                                        {% widthratio statistics.avg_taux_boursiers 1 100 %}%
                                    </h2>
                                    <div class="progress mt-3">
                                        <div class="progress-bar bg-info" 
                                             role="progressbar" 
                                             style="width: {% widthratio statistics.avg_taux_boursiers 1 100 %}%" 
                                             aria-valuenow="{% widthratio statistics.avg_taux_boursiers 1 100 %}" 
                                             aria-valuemin="0" 
                                             aria-valuemax="100">
                                        </div>
                                    </div>
                                    <small class="text-muted">
                                        ({{ statistics.avg_taux_boursiers|floatformat:3 }} en décimal)
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-header bg-warning text-dark">
                                    <i class="fas fa-graduation-cap mr-2"></i>
                                    Total des diplômés
                                </div>
                                <div class="card-body text-center">
                                    <h2 class="mb-0 text-warning">
                                        {{ statistics.total_diplomes }}
                                    </h2>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tableau d'évolution -->
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-table mr-2"></i>
                                        Évolution des effectifs par année
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover table-striped">
                                            <thead class="thead-dark">
                                                <tr>
                                                    <th><i class="fas fa-calendar mr-1"></i>Année</th>
                                                    <th><i class="fas fa-user-graduate mr-1"></i>FIE1</th>
                                                    <th><i class="fas fa-user-graduate mr-1"></i>FIE2</th>
                                                    <th><i class="fas fa-user-graduate mr-1"></i>FIE3</th>
                                                    <th><i class="fas fa-users mr-1"></i>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in statistics.evolution_annuelle %}
                                                    <tr>
                                                        <td><strong>{{ item.annee }}</strong></td>
                                                        <td>{{ item.nombre_fie1 }}</td>
                                                        <td>{{ item.nombre_fie2 }}</td>
                                                        <td>{{ item.nombre_fie3 }}</td>
                                                        <td><strong>{{ item.nombre_fie1|add:item.nombre_fie2|add:item.nombre_fie3 }}</strong></td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                {% else %}
                    <!-- Aucune donnée -->
                    <div class="alert alert-warning">
                        <div class="row">
                            <div class="col-md-8">
                                <h5><i class="fas fa-exclamation-triangle mr-2"></i>Aucune donnée disponible</h5>
                                <p class="mb-0">Veuillez importer un fichier CSV pour commencer à visualiser les données.</p>
                            </div>
                            <div class="col-md-4 text-right">
                                <a href="{% url 'upload_csv' %}" class="btn btn-primary">
                                    <i class="fas fa-file-upload mr-1"></i>Importer un fichier CSV
                                </a>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Actions rapides et informations -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="fas fa-rocket mr-2"></i>
                    Actions rapides
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <a href="{% url 'upload_csv' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-file-upload mr-2 text-primary"></i>
                        Importer un fichier CSV
                    </a>
                    <a href="{% url 'view_data' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-table mr-2 text-success"></i>
                        Consulter les données
                    </a>
                    <a href="{% url 'charts' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar mr-2 text-info"></i>
                        Afficher les graphiques
                    </a>
                    <a href="{% url 'update_data' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-edit mr-2 text-warning"></i>
                        Mettre à jour des données
                    </a>
                    {% if user_info.role == 'admin' %}
                        <a href="{% url 'admin_users' %}" class="list-group-item list-group-item-action">
                            <i class="fas fa-users-cog mr-2 text-danger"></i>
                            Gestion des utilisateurs
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle mr-2"></i>
                    Instructions d'utilisation
                </h5>
            </div>
            <div class="card-body">
                <h6>Comment utiliser cette application :</h6>
                <ol>
                    <li><strong>Importez vos données</strong> en utilisant l'option "Importer CSV"</li>
                    <li><strong>Consultez les données brutes</strong> dans la section "Données"</li>
                    <li><strong>Visualisez différents graphiques</strong> dans la section "Graphiques"</li>
                    <li><strong>Mettez à jour les données</strong> existantes ou ajoutez-en de nouvelles</li>
                </ol>
                
                <div class="mt-3 p-2 bg-light rounded">
                    <h6 class="text-muted mb-2">Format du fichier CSV :</h6>
                    <small class="text-muted">
                        <strong>Colonnes requises :</strong><br>
                        • annee<br>
                        • nombre_fie1, nombre_fie2, nombre_fie3<br>
                        • taux_boursiers<br>
                        • nombre_diplomes<br>
                        • nombre_handicapes<br>
                        • nombre_etrangers<br>
                        • nombre_demissionnes
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    console.log('Dashboard loaded');
    
    // Animation des cartes statistiques
    $('.card').hover(function() {
        $(this).addClass('shadow-lg').removeClass('shadow');
    }, function() {
        $(this).removeClass('shadow-lg').addClass('shadow');
    });
});
</script>
{% endblock %}